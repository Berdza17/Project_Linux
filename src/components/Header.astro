---
/**
 * HEADER COMPONENT
 * Main navigation bar with logo, company name, and responsive menu.
 * 
 * Features:
 * - Desktop: Full horizontal navigation
 * - Mobile: Hamburger menu (< 768px)
 * - Active link highlighting
 * - Smooth transitions
 */

import { siteConfig } from '../config.js';

// Get current page path for active link highlighting
const currentPath = Astro.url.pathname;

// Check if we're on the homepage (for transparent header)
const isHomepage = currentPath === '/' || currentPath === '';

// Navigation links (Bosnian)
const navLinks = [
  { href: '/', label: 'Poƒçetna' },
  { href: '/gallery', label: 'Galerija' },
  { href: '/contact', label: 'Kontakt' },
  { href: '/about', label: 'O Nama' },
];
---

<header class={`header ${isHomepage ? 'header-transparent' : 'header-solid'}`}
  <div class="container">
    <div class="header-content">
      <!-- Logo and Company Name -->
      <a href="/" class="logo-link" aria-label="Idi na poƒçetnu stranicu">
        <img 
          src={siteConfig.logo.path} 
          alt={siteConfig.logo.alt} 
          class="logo-image"
          width="50"
          height="50"
        />
        <span class="company-name">{siteConfig.companyName}</span>
      </a>

      <!-- Desktop Navigation -->
      <nav class="nav-desktop" aria-label="Glavna navigacija">
        <ul class="nav-list">
          {navLinks.map((link) => (
            <li class="nav-item">
              <a 
                href={link.href} 
                class={`nav-link ${currentPath === link.href ? 'active' : ''}`}
                aria-current={currentPath === link.href ? 'page' : undefined}
              >
                {link.label}
              </a>
            </li>
          ))}
        </ul>
      </nav>

      <!-- Theme Toggle Switch (Desktop only) -->
      <button 
        class="theme-toggle theme-toggle-desktop" 
        id="theme-toggle"
        aria-label="Promijeni temu"
        title="Promijeni temu"
        role="switch"
        aria-checked="false"
      >
        <span class="toggle-track">
          <span class="toggle-thumb"></span>
        </span>
        <span class="toggle-icons">
          <span class="toggle-icon-sun">‚òÄÔ∏è</span>
          <span class="toggle-icon-moon">üåô</span>
        </span>
      </button>

      <!-- Mobile Hamburger Button -->
      <button 
        class="hamburger" 
        aria-label="Otvori/Zatvori navigacijski meni"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
      </button>
    </div>

    <!-- Mobile Navigation Menu -->
    <nav 
      class="nav-mobile" 
      id="mobile-menu"
      aria-label="Mobilna navigacija"
    >
      <ul class="nav-mobile-list">
        {navLinks.map((link) => (
          <li class="nav-mobile-item">
            <a 
              href={link.href} 
              class={`nav-mobile-link ${currentPath === link.href ? 'active' : ''}`}
              aria-current={currentPath === link.href ? 'page' : undefined}
            >
              {link.label}
            </a>
          </li>
        ))}
      </ul>
      
      <!-- Theme Toggle (Mobile) -->
      <div class="mobile-theme-toggle">
        <span class="mobile-theme-label">Tema:</span>
        <button 
          class="theme-toggle theme-toggle-mobile" 
          id="theme-toggle-mobile"
          aria-label="Promijeni temu"
          role="switch"
          aria-checked="false"
        >
          <span class="toggle-track">
            <span class="toggle-thumb"></span>
          </span>
          <span class="toggle-icons">
            <span class="toggle-icon-sun">‚òÄÔ∏è</span>
            <span class="toggle-icon-moon">üåô</span>
          </span>
        </button>
      </div>
    </nav>
  </div>
</header>

<style>
  /* ============================================
     HEADER CONTAINER
     ============================================ */
  .header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 9999;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
  }

  /* Solid header (default for all pages except homepage) */
  .header-solid {
    background-color: var(--color-bg);
    box-shadow: var(--shadow-sm);
  }

  /* Transparent header (homepage only) */
  .header-transparent {
    background-color: transparent;
    box-shadow: none;
  }

  /* Make header solid when scrolled OR when mobile menu is open */
  .header-transparent.scrolled,
  .header-transparent.menu-open {
    background-color: var(--color-bg);
    box-shadow: var(--shadow-sm);
  }

  .header-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0;
    height: 50px;
  }

  @media (min-width: 768px) {
    .header-content {
      padding: var(--space-8) 0;
      height: auto;
      min-height: 60px;
    }
  }

  /* ============================================
     LOGO & COMPANY NAME
     ============================================ */
  .logo-link {
    display: flex;
    align-items: center;
    gap: var(--space-12);
    text-decoration: none;
    transition: opacity var(--transition-fast);
  }

  .logo-link:hover {
    opacity: 0.8;
    text-decoration: none;
  }

  .logo-link:focus {
    outline: 2px solid var(--color-primary);
    outline-offset: 4px;
    border-radius: var(--radius-sm);
  }

  .logo-image {
    width: 50px;
    height: 50px;
    object-fit: contain;
    display: block;
  }

  .company-name {
    font-family: var(--font-family-heading);
    font-size: var(--font-size-xl);
    font-weight: var(--font-weight-bold);
    color: var(--color-text);
    white-space: nowrap;
    transition: color 0.3s ease;
  }

  /* Light text when header is transparent (over hero - homepage only) */
  .header-transparent:not(.scrolled):not(.menu-open) .company-name {
    color: var(--color-text-light);
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
  }

  /* Hide company name on very small screens */
  @media (max-width: 480px) {
    .company-name {
      display: none;
    }
  }

  /* ============================================
     DESKTOP NAVIGATION
     ============================================ */
  .nav-desktop {
    display: none; /* Hidden on mobile by default */
  }

  .nav-list {
    display: flex;
    align-items: center;
    gap: var(--space-32);
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .nav-item {
    margin: 0;
  }

  .nav-link {
    font-size: var(--font-size-base);
    font-weight: var(--font-weight-medium);
    color: var(--color-text);
    text-decoration: none;
    padding: var(--space-8) var(--space-4);
    position: relative;
    transition: color 0.3s ease;
  }

  .nav-link:hover {
    color: var(--color-primary);
    text-decoration: none;
  }

  /* Active link underline */
  .nav-link.active {
    color: var(--color-primary);
  }

  .nav-link.active::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 2px;
    background-color: var(--color-primary);
  }

  /* Light text when header is transparent (desktop only - nav links not visible on mobile) */
  @media (min-width: 768px) {
    .header-transparent:not(.scrolled):not(.menu-open) .nav-link {
      color: var(--color-text-light);
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    }

    .header-transparent:not(.scrolled):not(.menu-open) .nav-link:hover {
      color: var(--color-bg-secondary);
    }

    .header-transparent:not(.scrolled):not(.menu-open) .nav-link.active {
      color: var(--color-text-light);
    }

    .header-transparent:not(.scrolled):not(.menu-open) .nav-link.active::after {
      background-color: var(--color-text-light);
    }
  }

  /* ============================================
     THEME TOGGLE SWITCH
     ============================================ */
  .theme-toggle {
    position: relative;
    display: flex;
    align-items: center;
    width: 60px;
    height: 30px;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
  }

  /* Desktop toggle - hidden on mobile */
  .theme-toggle-desktop {
    display: none;
    margin-right: var(--space-8);
  }

  @media (min-width: 768px) {
    .theme-toggle-desktop {
      display: flex;
    }
  }

  /* Mobile toggle in dropdown */
  .mobile-theme-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-12);
    padding: var(--space-4) var(--space-16);
    margin-top: 0;
  }

  .mobile-theme-label {
    font-size: var(--font-size-base);
    color: var(--color-text-secondary);
  }

  .theme-toggle-mobile {
    display: flex;
  }

  .theme-toggle:focus {
    outline: none;
  }

  .theme-toggle:focus .toggle-track {
    box-shadow: 0 0 0 2px var(--color-primary);
  }

  /* The track (background bar) */
  .toggle-track {
    position: absolute;
    width: 100%;
    height: 100%;
    background: var(--color-bg-tertiary);
    border-radius: 15px;
    border: 2px solid var(--color-border);
    transition: background 0.3s ease, border-color 0.3s ease;
  }

  .theme-toggle:hover .toggle-track {
    border-color: var(--color-primary);
  }

  /* The sliding thumb */
  .toggle-thumb {
    position: absolute;
    top: 2px;
    left: 2px;
    width: 22px;
    height: 22px;
    background: var(--color-primary);
    border-radius: 50%;
    transition: transform 0.3s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  }

  /* Icons container */
  .toggle-icons {
    position: absolute;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 6px;
    pointer-events: none;
    z-index: 1;
  }

  .toggle-icon-sun,
  .toggle-icon-moon {
    font-size: 0.75rem;
    transition: opacity 0.3s ease;
  }

  /* Light mode: sun bright, moon dim */
  .toggle-icon-sun {
    opacity: 1;
  }

  .toggle-icon-moon {
    opacity: 0.4;
  }

  /* Dark theme styles */
  :root[data-theme="dark"] .toggle-track {
    background: #2a2a3a;
    border-color: #3a3a4a;
  }

  :root[data-theme="dark"] .toggle-thumb {
    transform: translateX(32px);
    background: #6a6a8a;
  }

  :root[data-theme="dark"] .toggle-icon-sun {
    opacity: 0.4;
  }

  :root[data-theme="dark"] .toggle-icon-moon {
    opacity: 1;
  }

  /* Transparent header styling - Light mode (desktop only) */
  @media (min-width: 768px) {
    .header-transparent:not(.scrolled):not(.menu-open) .toggle-track {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.3);
    }

    .header-transparent:not(.scrolled):not(.menu-open) .toggle-thumb {
      background: rgba(255, 255, 255, 0.9);
    }

    .header-transparent:not(.scrolled):not(.menu-open) .theme-toggle:hover .toggle-track {
      border-color: rgba(255, 255, 255, 0.5);
    }

    /* Transparent header styling - Dark mode (override) */
    :root[data-theme="dark"] .header-transparent:not(.scrolled):not(.menu-open) .toggle-thumb {
      transform: translateX(32px);
      background: #6a6a8a;
    }
  }

  /* ============================================
     HAMBURGER MENU BUTTON (Mobile)
     ============================================ */
  .hamburger {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    width: 30px;
    height: 24px;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
    margin-right: var(--space-8);
    z-index: var(--z-sticky);
  }

  .hamburger:focus {
    outline: 2px solid var(--color-primary);
    outline-offset: 4px;
    border-radius: var(--radius-sm);
  }

  .hamburger-line {
    width: 100%;
    height: 3px;
    background-color: var(--color-text);
    border-radius: var(--radius-sm);
    transition: all var(--transition-base);
  }

  /* White hamburger lines when header is transparent and menu is closed */
  .header-transparent:not(.scrolled):not(.menu-open) .hamburger-line {
    background-color: var(--color-text-light);
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
  }

  /* Hamburger animation when menu is open */
  .hamburger.active .hamburger-line:nth-child(1) {
    transform: translateY(10.5px) rotate(45deg);
  }

  .hamburger.active .hamburger-line:nth-child(2) {
    opacity: 0;
  }

  .hamburger.active .hamburger-line:nth-child(3) {
    transform: translateY(-10.5px) rotate(-45deg);
  }

  /* ============================================
     MOBILE NAVIGATION MENU
     ============================================ */
  .nav-mobile {
    display: block;
    max-height: 0;
    overflow: hidden;
    transition: max-height var(--transition-base);
  }

  .nav-mobile.open {
    max-height: 350px; /* Ensure theme toggle is visible */
  }

  .nav-mobile-list {
    list-style: none;
    margin: 0;
    padding: var(--space-8) 0;
  }

  .nav-mobile-item {
    margin: 0;
  }

  .nav-mobile-link {
    display: block;
    padding: var(--space-8) var(--space-8);
    font-size: var(--font-size-base);
    font-weight: var(--font-weight-medium);
    color: var(--color-text);
    text-decoration: none;
    border-left: 3px solid transparent;
    transition: all var(--transition-fast);
  }

  .nav-mobile-link:hover {
    background-color: var(--color-bg-secondary);
    border-left-color: var(--color-primary);
    padding-left: var(--space-16);
    text-decoration: none;
  }

  .nav-mobile-link.active {
    color: var(--color-primary);
    background-color: var(--color-bg-secondary);
    border-left-color: var(--color-primary);
    font-weight: var(--font-weight-bold);
  }

  /* ============================================
     RESPONSIVE BREAKPOINTS (Mobile-First)
     ============================================ */
  
  /* Tablet and Desktop (768px and up) */
  @media (min-width: 768px) {
    /* Show desktop navigation */
    .nav-desktop {
      display: block;
    }

    /* Hide hamburger button */
    .hamburger {
      display: none;
    }

    /* Hide mobile menu */
    .nav-mobile {
      display: none;
    }
  }

  /* Large desktop improvements */
  @media (min-width: 1024px) {
    .nav-list {
      gap: var(--space-40);
    }

    .company-name {
      font-size: var(--font-size-2xl);
    }
  }
</style>

<script>
  /**
   * MOBILE MENU TOGGLE
   * Vanilla JavaScript to handle hamburger menu functionality.
   * No external libraries required.
   */

  // Get references to DOM elements
  const hamburger = document.querySelector('.hamburger');
  const mobileMenu = document.querySelector('.nav-mobile');
  const mobileLinks = document.querySelectorAll('.nav-mobile-link');

  /**
   * Toggle mobile menu open/closed
   */
  function toggleMenu() {
    // Toggle 'active' class on hamburger (for animation)
    hamburger?.classList.toggle('active');
    
    // Toggle 'open' class on mobile menu (for sliding)
    mobileMenu?.classList.toggle('open');
    
    // Toggle 'menu-open' class on header (to make it solid when menu is open)
    header?.classList.toggle('menu-open');
    
    // Update aria-expanded attribute for accessibility
    const isExpanded = hamburger?.getAttribute('aria-expanded') === 'true';
    hamburger?.setAttribute('aria-expanded', String(!isExpanded));
  }

  /**
   * Close mobile menu
   */
  function closeMenu() {
    hamburger?.classList.remove('active');
    mobileMenu?.classList.remove('open');
    header?.classList.remove('menu-open');
    hamburger?.setAttribute('aria-expanded', 'false');
  }

  // Event listener: Toggle menu when hamburger is clicked
  hamburger?.addEventListener('click', toggleMenu);

  // Event listener: Close menu when a link is clicked (navigate to page)
  mobileLinks.forEach((link) => {
    link.addEventListener('click', closeMenu);
  });

  // Event listener: Close menu when clicking outside
  document.addEventListener('click', (event) => {
    const target = event.target as HTMLElement;
    
    // Check if click is outside header
    const isClickInside = target.closest('.header');
    const isMenuOpen = mobileMenu?.classList.contains('open');
    
    if (!isClickInside && isMenuOpen) {
      closeMenu();
    }
  });

  // Event listener: Close menu on escape key press
  document.addEventListener('keydown', (event) => {
    if (event.key === 'Escape') {
      closeMenu();
    }
  });

  // Prevent menu state issues on window resize
  window.addEventListener('resize', () => {
    // If window is resized to desktop size, ensure mobile menu is closed
    if (window.innerWidth >= 768) {
      closeMenu();
    }
  });

  // ============================================
  // SCROLL DETECTION - Add background on scroll
  // ============================================
  const header = document.querySelector('.header');
  
  function handleScroll() {
    if (window.scrollY > 50) {
      header?.classList.add('scrolled');
    } else {
      header?.classList.remove('scrolled');
    }
  }

  // Run on page load (in case page is already scrolled)
  handleScroll();

  // Listen for scroll events
  window.addEventListener('scroll', handleScroll, { passive: true });

  // ============================================
  // THEME TOGGLE - Light/Dark mode switching
  // ============================================
  const themeToggleDesktop = document.getElementById('theme-toggle');
  const themeToggleMobile = document.getElementById('theme-toggle-mobile');
  const html = document.documentElement;
  
  // Get saved theme or default to light
  function getStoredTheme(): string {
    return localStorage.getItem('theme') || 'light';
  }
  
  // Apply theme to document
  function applyTheme(theme: string) {
    if (theme === 'dark') {
      html.setAttribute('data-theme', 'dark');
      themeToggleDesktop?.setAttribute('aria-checked', 'true');
      themeToggleMobile?.setAttribute('aria-checked', 'true');
    } else {
      html.removeAttribute('data-theme');
      themeToggleDesktop?.setAttribute('aria-checked', 'false');
      themeToggleMobile?.setAttribute('aria-checked', 'false');
    }
  }
  
  // Toggle theme
  function toggleTheme() {
    const currentTheme = html.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    
    applyTheme(newTheme);
    localStorage.setItem('theme', newTheme);
  }
  
  // Apply saved theme on page load
  applyTheme(getStoredTheme());
  
  // Listen for theme toggle clicks (both desktop and mobile)
  themeToggleDesktop?.addEventListener('click', toggleTheme);
  themeToggleMobile?.addEventListener('click', toggleTheme);
</script>

